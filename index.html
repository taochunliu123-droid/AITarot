<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PMÈáåÈï∑‰ºØÂ°îÁæÖÁâå | PM Mayors Tarot</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --cyber-cyan: #00FFFF;
            --cyber-cyan-dim: rgba(0, 255, 255, 0.3);
            --cyber-orange: #FF6B35;
            --cyber-purple: #9D4EDD;
            --cyber-red: #FF3366;
            --cyber-gold: #FFD700;
            --bg-dark: #0a0a0f;
            --bg-panel: rgba(10, 20, 40, 0.85);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg-dark);
            color: var(--cyber-cyan);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #printArea, #printArea * {
                visibility: visible;
            }
            #printArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                background: white !important;
                color: black !important;
                padding: 40px;
            }
            .no-print {
                display: none !important;
            }
        }

        /* Scanlines */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,255,0.02) 2px, rgba(0,255,255,0.02) 4px);
            animation: scanMove 8s linear infinite;
        }

        @keyframes scanMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }

        /* Particle Canvas */
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        /* Video Background */
        #videoContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0f0f1a 100%);
        }

        #webcam {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.4) contrast(1.3) saturate(0.8);
            transform: scaleX(-1);
            display: none;
        }

        #webcam.active {
            display: block;
        }

        #handCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        /* Main Container */
        .main-container {
            position: relative;
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 140px;
            z-index: 10;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-container {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 2px solid var(--cyber-cyan);
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 255, 255, 0.1);
            animation: logoPulse 2s ease-in-out infinite;
            flex-shrink: 0;
        }

        .logo-container img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .logo-fallback {
            text-align: center;
        }

        .logo-fallback .pm {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--cyber-cyan);
        }

        .logo-fallback .mayors {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.6rem;
            color: var(--cyber-orange);
        }

        @keyframes logoPulse {
            0%, 100% { box-shadow: 0 0 10px var(--cyber-cyan); }
            50% { box-shadow: 0 0 25px var(--cyber-cyan), 0 0 50px var(--cyber-orange); }
        }

        .title-section h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.2rem, 4vw, 2rem);
            font-weight: 900;
            background: linear-gradient(90deg, var(--cyber-cyan), var(--cyber-orange), var(--cyber-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .title-section .subtitle {
            font-size: 0.75rem;
            color: var(--cyber-cyan-dim);
            letter-spacing: 2px;
        }

        /* Camera Status */
        .camera-status {
            position: fixed;
            top: 100px;
            left: 20px;
            z-index: 200;
            background: var(--bg-panel);
            border: 1px solid var(--cyber-cyan);
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(10px);
            max-width: 280px;
        }

        .camera-status.hidden {
            display: none;
        }

        .status-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            color: var(--cyber-orange);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-title::before {
            content: '‚óÜ';
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.8rem;
            border-bottom: 1px dashed rgba(0,255,255,0.2);
        }

        .status-item .label {
            color: #888;
        }

        .status-item .value {
            font-family: 'Orbitron', sans-serif;
        }

        .status-item .value.active {
            color: #00FF00;
        }

        .status-item .value.warning {
            color: var(--cyber-orange);
        }

        .status-item .value.error {
            color: var(--cyber-red);
        }

        .camera-note {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 107, 53, 0.1);
            border-radius: 5px;
            font-size: 0.7rem;
            color: var(--cyber-orange);
            line-height: 1.4;
        }

        /* Time Display */
        .time-display {
            text-align: right;
            background: var(--bg-panel);
            border: 1px solid var(--cyber-cyan);
            border-radius: 8px;
            padding: 12px;
            backdrop-filter: blur(10px);
        }

        .current-time {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--cyber-cyan);
            text-shadow: 0 0 15px var(--cyber-cyan);
        }

        .current-date {
            font-size: 0.8rem;
            color: var(--cyber-orange);
        }

        /* HUD Panel */
        .hud-panel {
            background: var(--bg-panel);
            border: 1px solid var(--cyber-cyan);
            border-radius: 8px;
            padding: 15px;
            backdrop-filter: blur(10px);
            position: relative;
        }

        .hud-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 20px;
            right: 20px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--cyber-cyan), transparent);
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            color: var(--cyber-orange);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-title::before {
            content: '‚óÜ';
            animation: blink 1s infinite;
        }

        /* Tarot Section */
        .tarot-section {
            max-width: 1000px;
            margin: 0 auto;
            padding-top: 20px;
        }

        .tarot-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .tarot-header h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            color: var(--cyber-cyan);
            margin-bottom: 5px;
        }

        .tarot-header .subtitle-en {
            font-size: 0.8rem;
            color: var(--cyber-purple);
            margin-bottom: 5px;
        }

        .tarot-header p {
            color: #666;
            font-size: 0.85rem;
        }

        /* Card Deck */
        .card-deck {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            perspective: 1500px;
            min-height: 300px;
            align-items: center;
        }

        .tarot-card {
            width: clamp(120px, 20vw, 160px);
            height: clamp(200px, 35vw, 280px);
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease;
        }

        .tarot-card:hover:not(.flipped) {
            transform: translateY(-15px) rotateY(5deg) rotateX(5deg);
        }

        .tarot-card.flipped {
            transform: rotateY(180deg);
        }

        .tarot-card.drawing {
            animation: cardShuffle 0.5s ease-in-out;
        }

        @keyframes cardShuffle {
            0% { transform: translateY(0) rotateZ(0); }
            25% { transform: translateY(-50px) rotateZ(-10deg); }
            50% { transform: translateY(-30px) rotateZ(10deg); }
            75% { transform: translateY(-40px) rotateZ(-5deg); }
            100% { transform: translateY(0) rotateZ(0); }
        }

        .tarot-card.reveal {
            animation: cardReveal 1s ease-out forwards;
        }

        @keyframes cardReveal {
            0% { 
                transform: rotateY(0) scale(0.8);
                filter: brightness(2);
            }
            50% { 
                transform: rotateY(90deg) scale(1.1);
                filter: brightness(3);
            }
            100% { 
                transform: rotateY(180deg) scale(1);
                filter: brightness(1);
            }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 12px;
            overflow: hidden;
        }

        .card-back {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f1a 100%);
            border: 2px solid var(--cyber-cyan);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px var(--cyber-cyan-dim), inset 0 0 50px rgba(0, 255, 255, 0.1);
        }

        .card-back::before {
            content: '';
            position: absolute;
            width: 85%;
            height: 85%;
            border: 1px dashed var(--cyber-cyan);
            border-radius: 8px;
            animation: rotateFrame 20s linear infinite;
        }

        .card-back::after {
            content: '';
            position: absolute;
            width: 70%;
            height: 70%;
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-radius: 8px;
            animation: rotateFrame 15s linear infinite reverse;
        }

        @keyframes rotateFrame {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .card-pattern {
            font-size: clamp(2.5rem, 8vw, 4rem);
            color: var(--cyber-cyan);
            text-shadow: 0 0 30px var(--cyber-cyan);
            animation: patternPulse 2s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes patternPulse {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .card-front {
            background: linear-gradient(180deg, #0f0f1a 0%, #1a1a2e 50%, #0f0f1a 100%);
            border: 2px solid var(--cyber-gold);
            transform: rotateY(180deg);
            padding: 12px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.4), inset 0 0 30px rgba(255, 215, 0, 0.1);
        }

        .card-position {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.65rem;
            color: var(--cyber-purple);
            text-align: center;
        }

        .card-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            color: var(--cyber-gold);
            text-align: center;
            margin-top: 2px;
        }

        .card-image {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(3rem, 10vw, 5rem);
            text-shadow: 0 0 30px currentColor;
        }

        .card-name {
            text-align: center;
            margin-top: 8px;
        }

        .card-name .zh {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--cyber-cyan);
            text-shadow: 0 0 10px var(--cyber-cyan);
        }

        .card-name .en {
            font-size: 0.6rem;
            color: #888;
            margin-top: 2px;
        }

        .card-meaning {
            font-size: 0.6rem;
            color: #666;
            text-align: center;
            margin-top: 5px;
            line-height: 1.3;
        }

        /* Control Panel */
        .control-panel {
            background: var(--bg-panel);
            border: 1px solid var(--cyber-cyan);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .control-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            color: var(--cyber-orange);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .control-title::before {
            content: '‚ñ∂';
            animation: blink 1s infinite;
        }

        .control-title .en {
            font-size: 0.7rem;
            color: #666;
            margin-left: 10px;
        }

        .question-input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid var(--cyber-cyan-dim);
            border-radius: 8px;
            color: var(--cyber-cyan);
            font-size: 1rem;
            font-family: 'Noto Sans TC', sans-serif;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .question-input:focus {
            outline: none;
            border-color: var(--cyber-cyan);
            box-shadow: 0 0 25px var(--cyber-cyan-dim);
        }

        .question-input::placeholder {
            color: #555;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 20px;
            background: linear-gradient(135deg, transparent, rgba(0, 255, 255, 0.1));
            border: 2px solid var(--cyber-cyan);
            border-radius: 8px;
            color: var(--cyber-cyan);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.3), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: rgba(0, 255, 255, 0.2);
            box-shadow: 0 0 30px var(--cyber-cyan-dim);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.primary {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.2), rgba(157, 78, 221, 0.2));
            border-color: var(--cyber-purple);
        }

        .btn .btn-text {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
        }

        .btn .btn-text .zh {
            font-size: 0.9rem;
        }

        .btn .btn-text .en {
            font-size: 0.6rem;
            opacity: 0.7;
        }

        /* Reading Result */
        .reading-result {
            background: var(--bg-panel);
            border: 1px solid var(--cyber-purple);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .reading-result.show {
            display: block;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .reading-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .reading-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--cyber-purple);
        }

        .reading-title .en {
            font-size: 0.7rem;
            color: #888;
            display: block;
            margin-top: 3px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-action {
            padding: 10px 15px;
            background: transparent;
            border: 1px solid var(--cyber-orange);
            border-radius: 5px;
            color: var(--cyber-orange);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-action:hover {
            background: var(--cyber-orange);
            color: #000;
        }

        .btn-action svg {
            width: 16px;
            height: 16px;
        }

        .reading-content {
            line-height: 1.8;
            color: #ccc;
        }

        .reading-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 3px solid var(--cyber-cyan);
        }

        .reading-section h4 {
            color: var(--cyber-cyan);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .reading-section h4 .en {
            font-size: 0.65rem;
            color: #666;
            margin-left: 10px;
        }

        .reading-section p {
            color: #aaa;
            font-size: 0.9rem;
        }

        .reading-section .en-text {
            color: #777;
            font-size: 0.8rem;
            font-style: italic;
            margin-top: 5px;
        }

        .summary-box {
            background: linear-gradient(135deg, rgba(157, 78, 221, 0.1), rgba(0, 255, 255, 0.1));
            border: 1px solid var(--cyber-purple);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .summary-box h4 {
            color: var(--cyber-gold);
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .summary-box h4 .en {
            font-size: 0.7rem;
            color: #888;
            display: block;
            margin-top: 3px;
        }

        .summary-text {
            text-align: center;
            font-size: 1rem;
            color: var(--cyber-cyan);
            line-height: 1.6;
        }

        .summary-text .en-text {
            color: #888;
            font-size: 0.85rem;
            margin-top: 10px;
            font-style: italic;
        }

        /* Print Area */
        #printArea {
            display: none;
        }

        #printArea.printing {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            min-height: 100vh;
            background: white;
            color: black;
            padding: 40px;
            z-index: 10000;
            overflow: auto;
        }

        .print-header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 20px;
        }

        .print-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .print-header p {
            color: #666;
        }

        .print-cards {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }

        .print-card {
            width: 120px;
            padding: 15px;
            border: 2px solid #333;
            border-radius: 10px;
            text-align: center;
        }

        .print-card .symbol {
            font-size: 40px;
            margin: 10px 0;
        }

        .print-card .name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .print-section {
            margin: 20px 0;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .print-section h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .print-summary {
            margin-top: 30px;
            padding: 20px;
            background: #e8e8e8;
            border-radius: 10px;
            text-align: center;
        }

        .print-footer {
            margin-top: 40px;
            text-align: center;
            color: #888;
            font-size: 12px;
        }

        /* Floating Footer */
        .floating-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(180deg, transparent, rgba(10, 10, 15, 0.98));
            padding: 15px 20px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .footer-text {
            font-size: 0.85rem;
            color: var(--cyber-cyan);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-text .emoji {
            font-size: 1.3rem;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .footer-link {
            color: var(--cyber-orange);
            text-decoration: none;
            padding: 8px 18px;
            border: 1px solid var(--cyber-orange);
            border-radius: 20px;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-link:hover {
            background: var(--cyber-orange);
            color: #000;
            box-shadow: 0 0 20px var(--cyber-orange);
        }

        .footer-link svg {
            width: 14px;
            height: 14px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.8s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 3px solid var(--cyber-cyan-dim);
            border-top-color: var(--cyber-cyan);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-family: 'Orbitron', sans-serif;
            color: var(--cyber-cyan);
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .loading-text .en {
            font-size: 0.7rem;
            color: #666;
            display: block;
            margin-top: 5px;
        }

        /* Energy Burst Effect */
        .energy-burst {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0,255,255,0.8) 0%, transparent 70%);
            pointer-events: none;
            z-index: 200;
            opacity: 0;
        }

        .energy-burst.active {
            animation: energyBurst 1s ease-out forwards;
        }

        @keyframes energyBurst {
            0% { width: 0; height: 0; opacity: 1; }
            100% { width: 150vmax; height: 150vmax; opacity: 0; }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .camera-status {
                position: relative;
                top: auto;
                left: auto;
                max-width: 100%;
                margin-bottom: 15px;
            }

            .header {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .time-display {
                text-align: center;
                width: 100%;
            }

            .card-deck {
                gap: 10px;
            }

            .tarot-card {
                width: 100px;
                height: 170px;
            }

            .card-image {
                font-size: 2.5rem;
            }

            .btn-group {
                flex-direction: column;
            }

            .action-buttons {
                width: 100%;
                justify-content: center;
            }

            .reading-header {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Corner Decorations */
        .corner {
            position: fixed;
            width: 60px;
            height: 60px;
            border: 2px solid var(--cyber-cyan-dim);
            pointer-events: none;
            z-index: 5;
        }

        .corner.tl { top: 10px; left: 10px; border-right: none; border-bottom: none; }
        .corner.tr { top: 10px; right: 10px; border-left: none; border-bottom: none; }
        .corner.bl { bottom: 80px; left: 10px; border-right: none; border-top: none; }
        .corner.br { bottom: 80px; right: 10px; border-left: none; border-top: none; }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-panel);
            border: 1px solid var(--cyber-cyan);
            border-radius: 8px;
            padding: 15px 25px;
            color: var(--cyber-cyan);
            font-size: 0.9rem;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">
            Á≥ªÁµ±ÂàùÂßãÂåñ‰∏≠...
            <span class="en">Initializing System...</span>
        </div>
    </div>

    <!-- Scanlines -->
    <div class="scanlines"></div>

    <!-- Particle Canvas -->
    <canvas id="particleCanvas"></canvas>

    <!-- Energy Burst Effect -->
    <div class="energy-burst" id="energyBurst"></div>

    <!-- Corner Decorations -->
    <div class="corner tl"></div>
    <div class="corner tr"></div>
    <div class="corner bl"></div>
    <div class="corner br"></div>

    <!-- Video Background -->
    <div id="videoContainer">
        <video id="webcam" autoplay playsinline muted></video>
    </div>

    <!-- Hand Canvas -->
    <canvas id="handCanvas"></canvas>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Print Area -->
    <div id="printArea">
        <div class="print-header">
            <h1>PMÈáåÈï∑‰ºØÂ°îÁæÖÁâå | PM Mayors Tarot</h1>
            <p id="printDate"></p>
        </div>
        <div id="printQuestion"></div>
        <div class="print-cards" id="printCards"></div>
        <div id="printReadings"></div>
        <div class="print-summary" id="printSummary"></div>
        <div class="print-footer">
            <p>üèòÔ∏è ÈáåÈï∑‰ºØÂπ´Âä©ÊÇ®Áî®AIÁé©ËΩâÊïèÊç∑</p>
            <p>Provided by Tao Chun Liu (PM Mayors) | linkedin.com/in/taochunliu</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container" id="mainContent">
        <!-- Header -->
        <header class="header">
            <div class="logo-section">
                <div class="logo-container">
                    <img src="./logo.png" alt="PM Mayors" id="logoImg" style="display: none;">
                    <div class="logo-fallback" id="logoFallback">
                        <div class="pm">PM</div>
                        <div class="mayors">MAYORS</div>
                    </div>
                </div>
                <div class="title-section">
                    <h1>PMÈáåÈï∑‰ºØÂ°îÁæÖÁâå</h1>
                    <div class="subtitle">PM MAYORS ALGORITHMIC TAROT</div>
                </div>
            </div>
            <div class="time-display">
                <div class="current-time" id="currentTime">00:00:00</div>
                <div class="current-date" id="currentDate">2025-01-01</div>
            </div>
        </header>

        <!-- Camera Status -->
        <div class="camera-status" id="cameraStatus">
            <div class="status-title">
                Á≥ªÁµ±ÁãÄÊÖã <span style="font-size:0.6rem;color:#666">System Status</span>
            </div>
            <div class="status-item">
                <span class="label">ÊîùÂΩ±Ê©ü Camera</span>
                <span class="value" id="cameraValue">Ê™¢Ê∏¨‰∏≠...</span>
            </div>
            <div class="status-item">
                <span class="label">ÊâãÂã¢ËøΩËπ§ Gesture</span>
                <span class="value" id="gestureValue">ÂæÖÊ©ü‰∏≠</span>
            </div>
            <div class="status-item">
                <span class="label">ÁÆóÊ≥ïÂºïÊìé Engine</span>
                <span class="value active">Â∞±Á∑í Ready</span>
            </div>
            <div class="camera-note" id="cameraNote">
                üìù ÊâãÈÉ®ËøΩËπ§ÈúÄË¶ÅHTTPSÁí∞Â¢ÉÔºàÈÉ®ÁΩ≤Âà∞VercelÂæåÂç≥ÂèØ‰ΩøÁî®Ôºâ<br>
                Hand tracking requires HTTPS (deploy to Vercel to enable)
            </div>
        </div>

        <!-- Tarot Section -->
        <section class="tarot-section">
            <div class="tarot-header">
                <h2>‚óà ÁÆóÊ≥ïÂ°îÁæÖÂç†Âçú ‚óà</h2>
                <div class="subtitle-en">Algorithmic Tarot Divination</div>
                <p>ÁµêÂêàAIÈÅãÁÆóËàáÂè§ËÄÅÊô∫ÊÖßÁöÑÊú™‰æÜÂç†ÂçúÁ≥ªÁµ±</p>
                <p style="font-size:0.75rem;color:#555;">A futuristic divination system combining AI and ancient wisdom</p>
            </div>

            <!-- Card Deck -->
            <div class="card-deck" id="cardDeck"></div>

            <!-- Control Panel -->
            <div class="control-panel">
                <div class="control-title">
                    Âç†ÂçúÊéßÂà∂Âè∞
                    <span class="en">Divination Console</span>
                </div>
                <input 
                    type="text" 
                    class="question-input" 
                    id="questionInput" 
                    placeholder="Ëº∏ÂÖ•ÊÇ®ÁöÑÂïèÈ°å... / Enter your question..."
                >
                <div class="btn-group">
                    <button class="btn primary" id="btnDraw">
                        <span class="btn-text">
                            <span class="zh">‚óÜ ÂïüÂãïÂ°îÁæÖÁÆóÊ≥ï ‚óÜ</span>
                            <span class="en">Activate Tarot Algorithm</span>
                        </span>
                    </button>
                    <button class="btn" id="btnReset">
                        <span class="btn-text">
                            <span class="zh">ÈáçÁΩÆ Reset</span>
                        </span>
                    </button>
                </div>
            </div>

            <!-- Reading Result -->
            <div class="reading-result" id="readingResult">
                <div class="reading-header">
                    <div class="reading-title">
                        ‚óà ÁÆóÊ≥ïËß£ËÆÄÁµêÊûú
                        <span class="en">Algorithm Reading Results</span>
                    </div>
                    <div class="action-buttons">
                        <button class="btn-action" id="btnSaveImage" title="ÂÑ≤Â≠òÂúñÁâá Save Image">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2"/>
                                <circle cx="8.5" cy="8.5" r="1.5"/>
                                <path d="M21 15l-5-5L5 21"/>
                            </svg>
                            <span class="mobile-hide">ÂúñÁâá</span>
                        </button>
                        <button class="btn-action" id="btnPrint" title="ÂàóÂç∞PDF Print PDF">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M6 9V2h12v7"/>
                                <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
                                <rect x="6" y="14" width="12" height="8"/>
                            </svg>
                            <span class="mobile-hide">PDF</span>
                        </button>
                    </div>
                </div>
                <div class="reading-content" id="readingContent"></div>
            </div>
        </section>
    </div>

    <!-- Floating Footer -->
    <footer class="floating-footer">
        <div class="footer-content">
            <div class="footer-text">
                <span class="emoji">üèòÔ∏è</span>
                <span>ÈáåÈï∑‰ºØÂπ´Âä©ÊÇ®Áî®AIÁé©ËΩâÊïèÊç∑</span>
            </div>
            <a href="https://www.linkedin.com/in/taochunliu/" target="_blank" rel="noopener noreferrer" class="footer-link">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
                Tao Chun Liu (PM Mayors)
            </a>
        </div>
    </footer>

    <script>
        // ==================== DATA ====================
        const majorArcana = [
            { number: 0, nameZh: 'ÊÑöËÄÖ', nameEn: 'The Fool', symbol: 'üÉè', meaningZh: 'Êñ∞ÈñãÂßã„ÄÅÂÜíÈö™„ÄÅÁ¥îÁúü', meaningEn: 'New beginnings, adventure, innocence', color: '#FFD700' },
            { number: 1, nameZh: 'È≠îË°ìÂ∏´', nameEn: 'The Magician', symbol: 'üé©', meaningZh: 'ÂâµÈÄ†Âäõ„ÄÅÊäÄËÉΩ„ÄÅÊÑèÂøó', meaningEn: 'Creativity, skill, willpower', color: '#FF6B35' },
            { number: 2, nameZh: 'Â•≥Á•≠Âè∏', nameEn: 'High Priestess', symbol: 'üåô', meaningZh: 'Áõ¥Ë¶∫„ÄÅÁ•ûÁßò„ÄÅÂÖßÂú®Êô∫ÊÖß', meaningEn: 'Intuition, mystery, inner wisdom', color: '#9D4EDD' },
            { number: 3, nameZh: 'ÁöáÂêé', nameEn: 'The Empress', symbol: 'üëë', meaningZh: 'Ë±êÁõõ„ÄÅÊØçÊÄß„ÄÅÂâµÈÄ†', meaningEn: 'Abundance, fertility, creation', color: '#00FF00' },
            { number: 4, nameZh: 'ÁöáÂ∏ù', nameEn: 'The Emperor', symbol: '‚öîÔ∏è', meaningZh: 'Ê¨äÂ®Å„ÄÅÁµêÊßã„ÄÅÈ†òÂ∞é', meaningEn: 'Authority, structure, leadership', color: '#FF3366' },
            { number: 5, nameZh: 'ÊïôÁöá', nameEn: 'The Hierophant', symbol: '‚õ™', meaningZh: 'ÂÇ≥Áµ±„ÄÅÊåáÂ∞é„ÄÅ‰ø°‰ª∞', meaningEn: 'Tradition, guidance, faith', color: '#00FFFF' },
            { number: 6, nameZh: 'ÊàÄ‰∫∫', nameEn: 'The Lovers', symbol: 'üíï', meaningZh: 'ÊÑõÊÉÖ„ÄÅÈÅ∏Êìá„ÄÅÂíåË´ß', meaningEn: 'Love, choices, harmony', color: '#FF69B4' },
            { number: 7, nameZh: 'Êà∞Ëªä', nameEn: 'The Chariot', symbol: 'üèéÔ∏è', meaningZh: 'Ê±∫ÂøÉ„ÄÅÂãùÂà©„ÄÅÊéßÂà∂', meaningEn: 'Determination, victory, control', color: '#FFA500' },
            { number: 8, nameZh: 'ÂäõÈáè', nameEn: 'Strength', symbol: 'ü¶Å', meaningZh: 'ÂãáÊ∞£„ÄÅËÄêÂøÉ„ÄÅÂÖßÂú®ÂäõÈáè', meaningEn: 'Courage, patience, inner strength', color: '#FFD700' },
            { number: 9, nameZh: 'Èö±Â£´', nameEn: 'The Hermit', symbol: 'üèîÔ∏è', meaningZh: 'ÂÖßÁúÅ„ÄÅÂ∞ãÊ±Ç„ÄÅÊô∫ÊÖß', meaningEn: 'Introspection, seeking, wisdom', color: '#4169E1' },
            { number: 10, nameZh: 'ÂëΩÈÅã‰πãËº™', nameEn: 'Wheel of Fortune', symbol: 'üé°', meaningZh: 'ÂëΩÈÅã„ÄÅËΩâËÆä„ÄÅÊ©üÈÅá', meaningEn: 'Destiny, change, opportunity', color: '#9400D3' },
            { number: 11, nameZh: 'Ê≠£Áæ©', nameEn: 'Justice', symbol: '‚öñÔ∏è', meaningZh: 'ÂÖ¨Âπ≥„ÄÅÁúüÁõ∏„ÄÅÂõ†Êûú', meaningEn: 'Fairness, truth, karma', color: '#C0C0C0' },
            { number: 12, nameZh: 'ÂÄíÂêä‰∫∫', nameEn: 'The Hanged Man', symbol: 'üôÉ', meaningZh: 'ÁäßÁâ≤„ÄÅÊñ∞Ë¶ñËßí„ÄÅÁ≠âÂæÖ', meaningEn: 'Sacrifice, new perspective, waiting', color: '#4682B4' },
            { number: 13, nameZh: 'Ê≠ªÁ•û', nameEn: 'Death', symbol: 'üíÄ', meaningZh: 'ÁµêÊùü„ÄÅËΩâÂåñ„ÄÅÈáçÁîü', meaningEn: 'Endings, transformation, rebirth', color: '#2F4F4F' },
            { number: 14, nameZh: 'ÁØÄÂà∂', nameEn: 'Temperance', symbol: 'üè∫', meaningZh: 'Âπ≥Ë°°„ÄÅËÄêÂøÉ„ÄÅÈÅ©Â∫¶', meaningEn: 'Balance, patience, moderation', color: '#20B2AA' },
            { number: 15, nameZh: 'ÊÉ°È≠î', nameEn: 'The Devil', symbol: 'üòà', meaningZh: 'ÊùüÁ∏õ„ÄÅË™òÊÉë„ÄÅÈô∞ÊöóÈù¢', meaningEn: 'Bondage, temptation, shadow self', color: '#8B0000' },
            { number: 16, nameZh: 'È´òÂ°î', nameEn: 'The Tower', symbol: 'üóº', meaningZh: 'Á™ÅËÆä„ÄÅË¶∫ÈÜí„ÄÅËß£Êîæ', meaningEn: 'Upheaval, awakening, liberation', color: '#FF4500' },
            { number: 17, nameZh: 'ÊòüÊòü', nameEn: 'The Star', symbol: '‚≠ê', meaningZh: 'Â∏åÊúõ„ÄÅÈùàÊÑü„ÄÅÂπ≥Èùú', meaningEn: 'Hope, inspiration, serenity', color: '#00CED1' },
            { number: 18, nameZh: 'Êúà‰∫Æ', nameEn: 'The Moon', symbol: 'üåï', meaningZh: 'ÂπªË±°„ÄÅÁõ¥Ë¶∫„ÄÅÊÅêÊáº', meaningEn: 'Illusion, intuition, fear', color: '#E6E6FA' },
            { number: 19, nameZh: 'Â§™ÈôΩ', nameEn: 'The Sun', symbol: '‚òÄÔ∏è', meaningZh: 'ÊàêÂäü„ÄÅÂñúÊÇÖ„ÄÅÊ¥ªÂäõ', meaningEn: 'Success, joy, vitality', color: '#FFD700' },
            { number: 20, nameZh: 'ÂØ©Âà§', nameEn: 'Judgement', symbol: 'üìØ', meaningZh: 'Ë¶∫ÈÜí„ÄÅÈáçÁîü„ÄÅÂè¨Âñö', meaningEn: 'Awakening, rebirth, calling', color: '#DAA520' },
            { number: 21, nameZh: '‰∏ñÁïå', nameEn: 'The World', symbol: 'üåç', meaningZh: 'ÂÆåÊàê„ÄÅÊï¥Âêà„ÄÅÊàêÂ∞±', meaningEn: 'Completion, integration, achievement', color: '#00FF7F' }
        ];

        const positions = [
            { zh: 'ÈÅéÂéª', en: 'Past' },
            { zh: 'ÁèæÂú®', en: 'Present' },
            { zh: 'Êú™‰æÜ', en: 'Future' }
        ];

        // ==================== STATE ====================
        let selectedCards = [];
        let isDrawing = false;
        let particles = [];

        // ==================== PARTICLE SYSTEM ====================
        const particleCanvas = document.getElementById('particleCanvas');
        const pCtx = particleCanvas.getContext('2d');

        function resizeParticleCanvas() {
            particleCanvas.width = window.innerWidth;
            particleCanvas.height = window.innerHeight;
        }
        resizeParticleCanvas();
        window.addEventListener('resize', resizeParticleCanvas);

        class Particle {
            constructor(x, y, color, type = 'normal') {
                this.x = x;
                this.y = y;
                this.color = color;
                this.type = type;
                this.size = Math.random() * 5 + 2;
                this.speedX = (Math.random() - 0.5) * 15;
                this.speedY = (Math.random() - 0.5) * 15;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.01;
                this.gravity = type === 'spark' ? 0.1 : 0;
                this.trail = [];
            }

            update() {
                this.trail.push({ x: this.x, y: this.y, life: this.life });
                if (this.trail.length > 10) this.trail.shift();

                this.speedY += this.gravity;
                this.x += this.speedX;
                this.y += this.speedY;
                this.life -= this.decay;
                this.speedX *= 0.98;
                this.speedY *= 0.98;
            }

            draw(ctx) {
                // Draw trail
                this.trail.forEach((point, i) => {
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, this.size * (i / this.trail.length) * point.life, 0, Math.PI * 2);
                    ctx.fillStyle = this.color.replace('1)', `${point.life * 0.3})`);
                    ctx.fill();
                });

                // Draw main particle
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * this.life, 0, Math.PI * 2);
                ctx.fillStyle = this.color.replace('1)', `${this.life})`);
                ctx.fill();

                // Glow effect
                ctx.shadowBlur = 20;
                ctx.shadowColor = this.color;
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        function createExplosion(x, y, count = 50, color = 'rgba(0, 255, 255, 1)') {
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(x, y, color, 'spark'));
            }
        }

        function createMagicCircle(x, y) {
            const colors = ['rgba(0, 255, 255, 1)', 'rgba(255, 215, 0, 1)', 'rgba(157, 78, 221, 1)'];
            for (let i = 0; i < 100; i++) {
                const angle = (i / 100) * Math.PI * 2;
                const radius = 100 + Math.random() * 50;
                const px = x + Math.cos(angle) * radius;
                const py = y + Math.sin(angle) * radius;
                const particle = new Particle(px, py, colors[i % colors.length]);
                particle.speedX = (x - px) * 0.05;
                particle.speedY = (y - py) * 0.05;
                particles.push(particle);
            }
        }

        function animateParticles() {
            pCtx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);
            
            particles = particles.filter(p => p.life > 0);
            particles.forEach(p => {
                p.update();
                p.draw(pCtx);
            });

            requestAnimationFrame(animateParticles);
        }
        animateParticles();

        // ==================== CARD GENERATION ====================
        function generateCardDeck() {
            const deck = document.getElementById('cardDeck');
            deck.innerHTML = '';

            for (let i = 0; i < 3; i++) {
                const card = document.createElement('div');
                card.className = 'tarot-card';
                card.dataset.index = i;
                card.innerHTML = `
                    <div class="card-face card-back">
                        <div class="card-pattern">‚úß</div>
                    </div>
                    <div class="card-face card-front">
                        <div class="card-position">${positions[i].zh} | ${positions[i].en}</div>
                        <div class="card-number">--</div>
                        <div class="card-image">?</div>
                        <div class="card-name">
                            <div class="zh">Á≠âÂæÖÊè≠Á§∫</div>
                            <div class="en">Awaiting Reveal</div>
                        </div>
                        <div class="card-meaning">--</div>
                    </div>
                `;
                deck.appendChild(card);
            }
        }

        // ==================== DRAW CARDS ====================
        async function drawCards() {
            if (isDrawing) return;
            isDrawing = true;

            const btnDraw = document.getElementById('btnDraw');
            btnDraw.disabled = true;

            // Reset
            const cards = document.querySelectorAll('.tarot-card');
            cards.forEach(card => {
                card.classList.remove('flipped', 'reveal');
            });
            document.getElementById('readingResult').classList.remove('show');

            // Energy burst effect
            const burst = document.getElementById('energyBurst');
            burst.classList.add('active');
            setTimeout(() => burst.classList.remove('active'), 1000);

            // Create magic circle at center
            createMagicCircle(window.innerWidth / 2, window.innerHeight / 2);

            // Shuffle animation
            cards.forEach((card, i) => {
                setTimeout(() => {
                    card.classList.add('drawing');
                    setTimeout(() => card.classList.remove('drawing'), 500);
                }, i * 200);
            });

            await sleep(800);

            // Select random cards
            const shuffled = [...majorArcana].sort(() => Math.random() - 0.5);
            selectedCards = shuffled.slice(0, 3);

            // Reveal cards with effects
            for (let i = 0; i < 3; i++) {
                await sleep(800);
                const card = cards[i];
                const cardData = selectedCards[i];
                
                // Update card content
                const front = card.querySelector('.card-front');
                front.innerHTML = `
                    <div class="card-position">${positions[i].zh} | ${positions[i].en}</div>
                    <div class="card-number">#${cardData.number}</div>
                    <div class="card-image" style="color: ${cardData.color}">${cardData.symbol}</div>
                    <div class="card-name">
                        <div class="zh">${cardData.nameZh}</div>
                        <div class="en">${cardData.nameEn}</div>
                    </div>
                    <div class="card-meaning">${cardData.meaningZh}<br>${cardData.meaningEn}</div>
                `;

                // Flip with explosion
                card.classList.add('reveal');
                const rect = card.getBoundingClientRect();
                createExplosion(rect.left + rect.width / 2, rect.top + rect.height / 2, 30, `rgba(${hexToRgb(cardData.color)}, 1)`);
            }

            await sleep(1000);
            generateReading();
            
            isDrawing = false;
            btnDraw.disabled = false;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? 
                `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : 
                '0, 255, 255';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // ==================== GENERATE READING ====================
        function generateReading() {
            const question = document.getElementById('questionInput').value || 'ÈÄöÁî®Âç†Âçú General Reading';
            
            const readingsZh = [];
            const readingsEn = [];

            selectedCards.forEach((card, i) => {
                const posZh = positions[i].zh;
                const posEn = positions[i].en;
                
                const interpretationsZh = {
                    'ÈÅéÂéª': `Âú®ÊÇ®ÁöÑÈÅéÂæÄÁ∂ìÊ≠∑‰∏≠Ôºå${card.nameZh}ÁâåÁöÑÂá∫ÁèæË±°ÂæµËëó„Äå${card.meaningZh}„ÄçÁöÑËÉΩÈáè‰∏ÄÁõ¥Âú®ÂΩ±ÈüøËëóÊÇ®„ÄÇÈÄôÊÆµÁ∂ìÊ≠∑ÁÇ∫ÊÇ®ÁèæÂú®ÁöÑËôïÂ¢ÉÂ•†ÂÆö‰∫ÜÂü∫Á§é„ÄÇ`,
                    'ÁèæÂú®': `Ê≠§ÂàªÔºå${card.nameZh}ÁâåÊè≠Á§∫‰∫ÜÊÇ®Áï∂ÂâçÁöÑÊ†∏ÂøÉËÉΩÈáèÊòØ„Äå${card.meaningZh}„Äç„ÄÇÈÄôÊòØÁêÜËß£ÊÇ®ÁèæÊ≥ÅÁöÑÈóúÈçµË®äÊÅØ„ÄÇ`,
                    'Êú™‰æÜ': `Â±ïÊúõÊú™‰æÜÔºå${card.nameZh}ÁâåÈ†êÁ§∫Ëëó„Äå${card.meaningZh}„ÄçÁöÑËÉΩÈáèÂç≥Â∞áÈÄ≤ÂÖ•ÊÇ®ÁöÑÁîüÂëΩ„ÄÇË´ãÊïûÈñãÂøÉÊââËøéÊé•ÈÄô‰ªΩËΩâËÆä„ÄÇ`
                };

                const interpretationsEn = {
                    'Past': `In your past, the ${card.nameEn} card reveals the energy of "${card.meaningEn}" has been influencing your journey. This experience laid the foundation for your current situation.`,
                    'Present': `Currently, the ${card.nameEn} card shows your core energy is "${card.meaningEn}". This is the key message for understanding your present state.`,
                    'Future': `Looking ahead, the ${card.nameEn} card indicates the energy of "${card.meaningEn}" is about to enter your life. Open your heart to welcome this transformation.`
                };

                readingsZh.push({ position: posZh, card: card.nameZh, text: interpretationsZh[posZh] });
                readingsEn.push({ position: posEn, card: card.nameEn, text: interpretationsEn[posEn] });
            });

            // Generate summary
            const summaryZh = `Á∂úÂêà‰∏âÂºµÁâåÁöÑË®äÊÅØÔºöÂæû„Äå${selectedCards[0].nameZh}„ÄçÁöÑÈÅéÂæÄÁ∂ìÈ©óÔºåÂà∞„Äå${selectedCards[1].nameZh}„ÄçÁöÑÁèæÊ≥ÅË¶∫ÂØüÔºåÂÜçÂà∞„Äå${selectedCards[2].nameZh}„ÄçÁöÑÊú™‰æÜÊåáÂºï„ÄÇÂëΩÈÅãÁöÑÁÆóÊ≥ïÈ°ØÁ§∫ÔºåÊÇ®Ê≠£ËôïÊñºÈáçË¶ÅÁöÑ‰∫∫ÁîüËΩâÊäòÈªû„ÄÇÂª∫Ë≠∞‰øùÊåÅÈñãÊîæÁöÑÂøÉÊÖãÔºå‰ø°‰ªªÁõ¥Ë¶∫ÔºåÊìÅÊä±Âç≥Â∞áÂà∞‰æÜÁöÑÊîπËÆä„ÄÇ`;
            
            const summaryEn = `Synthesizing the three cards: from the past experience of "${selectedCards[0].nameEn}", to the present awareness of "${selectedCards[1].nameEn}", and the future guidance of "${selectedCards[2].nameEn}". The algorithm of destiny shows you are at an important turning point. Stay open-minded, trust your intuition, and embrace the coming changes.`;

            // Render content
            let html = `
                <div class="reading-section">
                    <h4>ÂïèÈ°å Question</h4>
                    <p>${question}</p>
                </div>
            `;

            readingsZh.forEach((reading, i) => {
                html += `
                    <div class="reading-section">
                        <h4>${reading.position}‰ΩçÁΩÆ - ${reading.card} <span class="en">${readingsEn[i].position} - ${readingsEn[i].card}</span></h4>
                        <p>${reading.text}</p>
                        <p class="en-text">${readingsEn[i].text}</p>
                    </div>
                `;
            });

            html += `
                <div class="summary-box">
                    <h4>
                        ‚≠ê Á∏ΩÁµêËß£ËÆÄ
                        <span class="en">Summary Reading</span>
                    </h4>
                    <p class="summary-text">
                        ${summaryZh}
                        <span class="en-text">${summaryEn}</span>
                    </p>
                </div>
            `;

            document.getElementById('readingContent').innerHTML = html;
            document.getElementById('readingResult').classList.add('show');

            // Store for print
            window.currentReading = { question, readingsZh, readingsEn, summaryZh, summaryEn };
        }

        // ==================== RESET ====================
        function resetCards() {
            selectedCards = [];
            generateCardDeck();
            document.getElementById('readingResult').classList.remove('show');
            document.getElementById('questionInput').value = '';
        }

        // ==================== SAVE IMAGE ====================
        async function saveAsImage() {
            showToast('Ê≠£Âú®ÁîüÊàêÂúñÁâá... Generating image...');

            try {
                const element = document.getElementById('mainContent');
                const canvas = await html2canvas(element, {
                    backgroundColor: '#0a0a0f',
                    scale: 2,
                    logging: false,
                    useCORS: true
                });

                const link = document.createElement('a');
                link.download = `PM-Mayors-Tarot-${Date.now()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                showToast('ÂúñÁâáÂ∑≤ÂÑ≤Â≠òÔºÅ Image saved!');
            } catch (error) {
                console.error('Save image error:', error);
                showToast('ÂÑ≤Â≠òÂ§±ÊïóÔºåË´ãÈáçË©¶ Save failed, please retry');
            }
        }

        // ==================== PRINT PDF ====================
        function printAsPDF() {
            if (!window.currentReading) {
                showToast('Ë´ãÂÖàÈÄ≤Ë°åÂç†Âçú Please draw cards first');
                return;
            }

            const { question, readingsZh, readingsEn, summaryZh, summaryEn } = window.currentReading;

            // Prepare print content
            document.getElementById('printDate').textContent = new Date().toLocaleString('zh-TW');
            document.getElementById('printQuestion').innerHTML = `<p><strong>ÂïèÈ°å Question:</strong> ${question}</p>`;

            // Cards
            let cardsHtml = '';
            selectedCards.forEach((card, i) => {
                cardsHtml += `
                    <div class="print-card">
                        <div>${positions[i].zh} | ${positions[i].en}</div>
                        <div class="symbol">${card.symbol}</div>
                        <div class="name">${card.nameZh}</div>
                        <div>${card.nameEn}</div>
                    </div>
                `;
            });
            document.getElementById('printCards').innerHTML = cardsHtml;

            // Readings
            let readingsHtml = '';
            readingsZh.forEach((reading, i) => {
                readingsHtml += `
                    <div class="print-section">
                        <h3>${reading.position} | ${readingsEn[i].position} - ${reading.card} | ${readingsEn[i].card}</h3>
                        <p>${reading.text}</p>
                        <p><em>${readingsEn[i].text}</em></p>
                    </div>
                `;
            });
            document.getElementById('printReadings').innerHTML = readingsHtml;

            // Summary
            document.getElementById('printSummary').innerHTML = `
                <h3>‚≠ê Á∏ΩÁµê Summary</h3>
                <p>${summaryZh}</p>
                <p><em>${summaryEn}</em></p>
            `;

            // Show print area and print
            const printArea = document.getElementById('printArea');
            printArea.classList.add('printing');

            setTimeout(() => {
                window.print();
                printArea.classList.remove('printing');
            }, 100);
        }

        // ==================== TOAST ====================
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // ==================== TIME UPDATE ====================
        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('zh-TW', { hour12: false });
            document.getElementById('currentDate').textContent = now.toLocaleDateString('zh-TW');
        }

        // ==================== CAMERA ====================
        async function initCamera() {
            const cameraValue = document.getElementById('cameraValue');
            const gestureValue = document.getElementById('gestureValue');
            const cameraNote = document.getElementById('cameraNote');
            const webcam = document.getElementById('webcam');

            // Check if HTTPS
            const isSecure = location.protocol === 'https:' || location.hostname === 'localhost';

            if (!isSecure) {
                cameraValue.textContent = 'ÈúÄË¶ÅHTTPS';
                cameraValue.className = 'value warning';
                cameraNote.innerHTML = `
                    ‚ö†Ô∏è ÊâãÈÉ®ËøΩËπ§ÈúÄË¶ÅHTTPSÁí∞Â¢É<br>
                    Hand tracking requires HTTPS<br><br>
                    üìç Ë´ãÈÉ®ÁΩ≤Âà∞ Vercel ÂæåÂç≥ÂèØ‰ΩøÁî®<br>
                    Deploy to Vercel to enable this feature
                `;
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user', width: 1280, height: 720 }
                });
                webcam.srcObject = stream;
                webcam.classList.add('active');
                cameraValue.textContent = 'Â∑≤ÂïüÁî® Active';
                cameraValue.className = 'value active';
                gestureValue.textContent = 'Â∞±Á∑í Ready';
                gestureValue.className = 'value active';
                cameraNote.innerHTML = `
                    ‚úÖ ÊîùÂΩ±Ê©üÂ∑≤ÂïüÁî®<br>
                    Camera activated<br><br>
                    üí° ÂÆåÊï¥ÊâãÂã¢ËøΩËπ§ÈúÄË¶Å MediaPipe Êï¥Âêà<br>
                    Full gesture tracking requires MediaPipe integration
                `;
            } catch (error) {
                console.error('Camera error:', error);
                cameraValue.textContent = 'Êú™ÊéàÊ¨ä Denied';
                cameraValue.className = 'value error';
                cameraNote.innerHTML = `
                    ‚ùå ÁÑ°Ê≥ïÂ≠òÂèñÊîùÂΩ±Ê©ü<br>
                    Cannot access camera<br><br>
                    Ë´ãÂÖÅË®±ÊîùÂΩ±Ê©üÊ¨äÈôêÊàñÊ™¢Êü•Ë®≠ÂÇô<br>
                    Please allow camera permission or check device
                `;
            }
        }

        // ==================== LOGO ====================
        function initLogo() {
            const logoImg = document.getElementById('logoImg');
            const logoFallback = document.getElementById('logoFallback');

            logoImg.onload = function() {
                logoImg.style.display = 'block';
                logoFallback.style.display = 'none';
            };

            logoImg.onerror = function() {
                logoImg.style.display = 'none';
                logoFallback.style.display = 'block';
            };

            // Trigger load check
            if (logoImg.complete) {
                if (logoImg.naturalHeight === 0) {
                    logoImg.onerror();
                } else {
                    logoImg.onload();
                }
            }
        }

        // ==================== INIT ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Hide loading
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 1500);

            // Initialize
            generateCardDeck();
            initLogo();
            initCamera();
            updateTime();
            setInterval(updateTime, 1000);

            // Event listeners
            document.getElementById('btnDraw').addEventListener('click', drawCards);
            document.getElementById('btnReset').addEventListener('click', resetCards);
            document.getElementById('btnSaveImage').addEventListener('click', saveAsImage);
            document.getElementById('btnPrint').addEventListener('click', printAsPDF);
            
            document.getElementById('questionInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') drawCards();
            });

            // Add ambient particles
            setInterval(() => {
                if (particles.length < 20) {
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;
                    const particle = new Particle(x, y, 'rgba(0, 255, 255, 0.5)');
                    particle.decay = 0.005;
                    particle.speedX = (Math.random() - 0.5) * 2;
                    particle.speedY = (Math.random() - 0.5) * 2;
                    particles.push(particle);
                }
            }, 500);
        });
    </script>
</body>
</html>
